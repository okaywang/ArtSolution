@model PagedSystemNoticeModel
@{    
    Layout = "~/Views/Shared/_ArtLayout.cshtml";
    ViewBag.Title = "评价管理";
}
<script src="~/Scripts/Views/MessageList.js"></script>
<div class="conterbox pingjia J_switchTab">
    <h2 class="crumbs">您所在位置：评价管理 > 站内信
    </h2>
    <div class="switchBox">
        <ul class="hd J_nav">
            <li class="J_cur">系统通知</li>
            <li>评价管理</li>
        </ul>
        <div class="bd">
            <div class="tab-content J_tabct systemBox">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="systemSearch ">
                    <tr>
                        <td class="startdateinp">发布时间：<input value="" name="" type="text" id="" class="calendarInp startdate" /></td>
                        <td class="enddateinp">结束时间：<input value="" name="" type="text" id="" class="calendarInp enddate" /></td>
                        <td class="zt">
                            <input type="submit" value="搜索" id="btnSearchNotice" class="searchBtn" />
                        </td>
                        <td></td>
                    </tr>
                </table>
                <div class="clearfix inform_dele">
                    <input type="button" value="发布通知" name="" class="searchBtn informBtn J_issueTz" />
                    <input type="button" value="批量删除" name="" class="searchBtn delebtn J_deleAllList" />
                </div>

                <div class="data">
                    @Html.Partial("_NoticeList", Model)
                </div>
            </div>
            <div class="tab-content J_tabct commentbox hide">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="systemSearch">
                    <tr>
                        <td class="startdateinp">发布时间：<input value="" name="" type="text" id="" class="calendarInp startdate" /></td>
                        <td class="enddateinp">结束时间：<input value="" name="" type="text" id="" class="calendarInp enddate" /></td>
                        <td class="zt">状态：
                                <select name="">
                                    <option selected="selected" value="">全部</option>
                                    <option value="">审核中</option>
                                    <option value="">审核通过</option>
                                    <option value="">审核不通过</option>
                                </select>
                        </td>
                        <td>
                            <input type="submit" value="搜索" name="" class="searchBtn" /></td>
                    </tr>
                </table>

                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tablestyle t-grid J_listbox">
                    <thead>
                        <tr class="theadbg">
                            <th ckass="t-num">序号</th>
                            <th class="t-time">发布时间</th>
                            <th class="t-zuopin">关联作品</th>
                            <th class="t-comment">评价内容</th>
                            <th class="t-zt">状态</th>
                            <th class="t-cz">操作</th>
                        </tr>
                    </thead>
                    <tr>
                        <td>1</td>
                        <td>2014-4-4 12：09:12</td>
                        <td>蒙娜丽莎的微笑</td>
                        <td align="left" class="J_commentNr">哇好漂亮的画哦</td>
                        <td><span class="t-gray">审核中</span></td>
                        <td><a class="t-green" href="###">审核通过</a> <a class="dele" href="###">审核不通过</a></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>2014-4-4 12：09:12</td>
                        <td>蒙娜丽莎的微笑</td>
                        <td align="left" class="J_commentNr">喜欢</td>
                        <td><span class="t-gray">审核通过</span></td>
                        <td><a class="J_reply" href="">回复</a></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>2014-4-4 12：09:12</td>
                        <td>蒙娜丽莎的微笑</td>
                        <td align="left" class="J_commentNr">真心不错，有点贵哇</td>
                        <td><span class="t-gray">审核不通过</span></td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>2014-4-4 12：09:12</td>
                        <td>蒙娜丽莎的微笑</td>
                        <td align="left" class="J_commentNr">真心不错，有点贵哇</td>
                        <td><span class="t-gray">己回复</span></td>
                        <td>-</td>
                    </tr>
                </table>

                <div class="grid-pager clearfix">
                    <div class="t-status-text">显示记录1-15,共66条</div>
                    <div class="t-pager t-reset">
                        <a href="#" class="t-link t-state-disabled">
                            <!--变灰不可选-->
                            <span class="t-icon t-arrow-first-gray">first</span>
                            <!--变高亮可选
                            <span class="t-icon t-arrow-first">first</span>
                            -->
                        </a>
                        <a href="#" class="t-link t-state-disabled">
                            <!--变灰不可选-->
                            <span class="t-icon t-arrow-prev-gray">prev</span>
                            <!--高亮可选
                            <span class="t-icon t-arrow-prev">prev</span>
                            -->
                        </a>
                        <div class="t-numeric">
                            <span class="t-state-active">1</span>
                            <a class="t-link num">2</a>
                            <a class="t-link num">3</a>
                            <a class="t-link num">4</a>
                            <a class="t-link num">5</a>
                        </div>
                        <a href="#" class="t-link">
                            <!--高亮可选-->
                            <span class="t-icon t-arrow-next">next</span>
                            <!--变灰不可选
                            <span class="t-icon t-arrow-next-gray">next</span>
                            -->
                        </a>
                        <a href="#" class="t-link">
                            <!--高亮可选-->
                            <span class="t-icon t-arrow-last">last</span>
                            <!--变灰不可选
                               <span class="t-icon t-arrow-last-gray">last</span>
                            -->
                        </a>
                    </div>

                    <div class="refresh">
                        <a href="" class="t-refresh">刷新</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--全部删除弹框 start-->
<div class="add-openbox" id="J_deleAllbox">
    <h2>全部删除提示<a href="javascript:void(0)" class="J_closebox xbtn"></a></h2>
    <p class="textinfo">
        确定删除所有消息列表吗，删除后不可恢复，请谨慎操作！
    </p>
    <p class="btnbox">
        <input value="确定" id="btnConfirmDeleteNoticeSelected" type="button" />
        <input value="取消" type="button" class="J_closebox" />
    </p>
</div>
<!--end-->

<!--单个删除弹框 start-->
<div class="add-openbox" id="J_delelistbox">
    <h2>删除提示<a href="javascript:void(0)" class="J_closebox xbtn"></a></h2>
    <p class="textinfo">
        确定删除该消息吗，删除后不可恢复，请谨慎操作！
    </p>
    <p class="btnbox">
        <input id="btnConfirmDeleteNotice" value="确定" type="button" class="J_closebox" />
        <input value="取消" type="button" class="J_closebox" />
    </p>
</div>
<!--end-->

<!--查看消息 start-->
<div class="add-openbox" id="J_lookAtbox">
    <h2>查看提示<a href="javascript:void(0)" class="J_closebox xbtn"></a></h2>
    <p class="l-textinfo">
        标题：乐艺网正式上线发布了
    </p>
    <p class="l-textinfo">
        内容：我们的乐艺网，正式发布上线了，期待你的使用~我们的乐艺网，正式发布上线了，期待你的使用~我们的乐艺网，正式发布上线了，期待你的使用~我们的乐艺网，正式发布上线了，期待你的使用~我们的乐艺网，正式发布上线了，期待你的使用~
    </p>
    <p class="btnbox">
        <input value="确定" type="button" class="J_closebox" />
        <input value="取消" type="button" class="J_closebox" />
    </p>
</div>
<!--end-->
<!--发布通知 start-->
<div class="add-openbox" id="J_issueTzbox">
    <h2>发布通知<a href="javascript:void(0)" class="J_closebox xbtn"></a></h2>
    <dl class="issueTz clearfix">
        <dt>标题：</dt>
        <dd>
            <input id="txtNoticeTitle" type="text" class="inp" /></dd>
    </dl>
    <dl class="issueTz clearfix">
        <dt>内容：</dt>
        <dd>
            <textarea id="txtNoticeContent" class="txtarea"></textarea></dd>
    </dl>

    <p class="btnbox">
        <input value="发布" id="btnNoticeConfirm" type="button" />
        <input value="取消" type="button" class="J_closebox" />
    </p>
</div>
<!--end-->
<!--回复 start-->
<div class="add-openbox" id="J_replybox">
    <h2>评价内容<a href="javascript:void(0)" class="J_closebox xbtn"></a></h2>
    <div class="comment clearfix">
        <div class="im-l">
            <dl class="clearfix">
                <dt>
                    <img src="i/1.jpg" /></dt>
                <dd>
                    <i></i>
                    <span class="time">2013-5-25 18：22
                    </span>
                    <p>
                        哇好漂亮的作品哇
                    </p>
                </dd>
            </dl>
        </div>
        <div class="im-r">
            <dl class="clearfix">
                <dt>
                    <img src="i/2.jpg" /></dt>
                <dd>
                    <i></i>
                    <span class="time">2013-5-25 18：22
                    </span>
                    <p>
                        谢谢亲，喜欢就买一副吧
                    </p>
                </dd>
            </dl>
        </div>

    </div>
    <div class="sendbox">
        <textarea class="sendtxt">

            </textarea>
        <input type="button" value="发送" name="" class="sendbtn" />
    </div>
</div>
<!--end-->
<script>
    $(document).ready(function () {
        var viewInstance = new art.ui.view.MessageList();

        //日历控件
        var adminjs = new adminglass();//实例化后台类
        adminjs.datepickerbox('.startdate', '.enddate');
        //tab切换
        adminjs.switchTab('.J_switchTab .J_nav li', '.J_switchTab');
        //checkbox 全选
        adminjs.clickCheck('.checkall', '.J_listbox');
        //删除
        ////关闭弹层
        $(".J_closebox").click(function () {
            adminjs.closewinbox($(this).closest(".add-openbox"));
        });


        ////发布消息
        $('.J_issueTz').click(function () {
            adminjs.openwinbox('#J_issueTzbox');
            return false
        });

        $("#btnNoticeConfirm").click(function () {
            var title = $("#txtNoticeTitle").val();
            var content = $("#txtNoticeContent").val();

            var url = "/Message/Publish";
            webExpress.utility.ajax.request(url, { title: title, content: content },
                function () {
                    adminjs.closewinbox("#J_issueTzbox");
                    $("#txtNoticeTitle").val("");
                    $("#txtNoticeContent").val("");

                    $(".startdate").val("");
                    $(".enddate").val("");
                    resetSearchNoticeCriteria();
                    refreshSystemNotices();
                },
                function () { 
                }
            );

            return false;
        });

        var _searchNoticeCriteria = { PagingRequest: { PageIndex: 0, PageSize: 10 } };
        function refreshSystemNotices(pageIndex) {
            var url = "/Message/NoticeList";
            if (pageIndex !== undefined) {
                _searchNoticeCriteria.PagingRequest.PageIndex = pageIndex;
            }
            webExpress.utility.ajax.request(url, _searchNoticeCriteria, function () {

            }, function (data) {
                $(".data").html(data.responseText);
                $(".data .grid-pager a[pageIndex]").click(function () {
                    refreshSystemNotices($(this).attr("pageIndex"));
                });
            });
        }


        $("#btnConfirmDeleteNotice").click(function () {
            deleteSystemNotice(currentNoticeId);
        });

        $("#btnConfirmDeleteNoticeSelected").click(function () {
            var $trs = $(":checkbox.checkItem:checked").closest("tr");
            var ids = $.map($trs, function (item,index) {
                return $(item).attr("noticeId");
            });
            adminjs.closewinbox($(this).closest(".add-openbox"));
            deleteSystemNotices(ids);
        });

        function deleteSystemNotice(noticeId) {
            var ids = [noticeId];
            deleteSystemNotices(ids);
        }

        function deleteSystemNotices(noticeIds) {
            var url = "/Message/DeleteNotices";
            webExpress.utility.ajax.request(url, { noticeIds: noticeIds }, function (data) {
                console.log("delete succ");
                refreshSystemNotices();
            }, function (data) {
                console.log("delete failture");
            });
        }

        $("#btnSearchNotice").click(function () {
            resetSearchNoticeCriteria();
            refreshSystemNotices();
        });

        function resetSearchNoticeCriteria() {
            _searchNoticeCriteria = { StartDate: $(".startdate ").val(), EndDate: $(".enddate").val(), PagingRequest: { PageIndex: 0, PageSize: 10 } };
        }

        var currentNoticeId = 0;
        ////删除所有
        $('.J_deleAllList').click(function () {
            adminjs.openwinbox('#J_deleAllbox');
            return false
        });
        ////删除单个
        $(document).on("click", ".J_deleList", function () {
            currentNoticeId = $(this).closest("tr").attr("noticeId");
            adminjs.openwinbox('#J_delelistbox');
            return false
        });
        ////查看消息
        $('.J_lookAt').click(function () {
            adminjs.openwinbox('#J_lookAtbox');
            return false
        });
        //发布通知
        $('.J_reply').click(function () {
            adminjs.openwinbox('#J_replybox');
            return false
        });
    })
</script>
